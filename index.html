<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="企業授信風險評估系統 - 快速查看客戶財務數據">
    <title>授信風險評估系統 | Credit Risk Assessment</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- SheetJS for Excel reading -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <link rel="stylesheet" href="style.css?v=4.0">
    <script src="config.js?v=4.0"></script>

</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="title">授信風險評估系統</h1>
                <p class="subtitle">Credit Risk Assessment Platform</p>
            </div>
        </header>

        <!-- Company Selector -->
        <section class="selector-section">
            <div class="selector-card">
                <label for="company-search" class="selector-label">選擇客戶 / Select Customer</label>
                <div class="search-wrapper">
                    <input type="text" id="company-search" class="company-input" placeholder="輸入公司名稱或股票代號..."
                        autocomplete="off">
                    <button id="clear-search" class="clear-btn" title="清除搜尋">✕</button>
                    <div id="suggestions" class="suggestions-dropdown"></div>
                </div>
                <button id="open-settings" class="settings-btn" title="API 設定">
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor"
                            d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11.03L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.97 19.05,5.05L16.56,6.05C16.04,5.65 15.47,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.53,5.32 7.96,5.65 7.44,6.05L4.95,5.05C4.73,4.97 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11.03C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.95C7.96,18.35 8.53,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.47,18.68 16.04,18.35 16.56,17.95L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z" />
                    </svg>
                </button>
            </div>
        </section>

        <!-- AML Anti-Money Laundering Detection -->
        <section id="aml-section" class="aml-section hidden">
            <div class="aml-card">
                <h2 class="section-title">🛡️ AML 檢測 (Anti-Money Laundering)</h2>
                <div class="aml-content" id="aml-content">
                    <div class="aml-loading">
                        <div class="loading-spinner"></div>
                        <p>正在搜尋相關新聞並分析風險...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Financial Charts -->
        <section id="charts-section" class="charts-section hidden">
            <div class="section-header">
                <h2 class="section-title" id="company-title">財務比率分析 Financial Ratios Analysis</h2>
            </div>

            <div class="charts-grid">
                <!-- 短期借款 -->
                <div class="chart-card">
                    <h3 class="chart-title">短期借款 (仟元)</h3>
                    <div class="chart-average" id="avg-std">平均值: --</div>
                    <canvas id="chart-std"></canvas>
                </div>

                <!-- 一年內到期長期負債 -->
                <div class="chart-card">
                    <h3 class="chart-title">一年內到期長期負債 (仟元)</h3>
                    <div class="chart-average" id="avg-cpltd">平均值: --</div>
                    <canvas id="chart-cpltd"></canvas>
                </div>

                <!-- 長期負債 -->
                <div class="chart-card">
                    <h3 class="chart-title">長期負債 (仟元)</h3>
                    <div class="chart-average" id="avg-ltd">平均值: --</div>
                    <canvas id="chart-ltd"></canvas>
                </div>

                <!-- EBITDA -->
                <div class="chart-card">
                    <h3 class="chart-title">EBITDA (仟元)</h3>
                    <div class="chart-average" id="avg-ebitda">平均值: --</div>
                    <canvas id="chart-ebitda"></canvas>
                </div>

                <!-- 營收淨額 -->
                <div class="chart-card">
                    <h3 class="chart-title">營收淨額 (仟元)</h3>
                    <div class="chart-average" id="avg-sales">平均值: --</div>
                    <canvas id="chart-sales"></canvas>
                </div>

                <!-- 自由現金流量 -->
                <div class="chart-card">
                    <h3 class="chart-title">自由現金流量 (仟元)</h3>
                    <div class="chart-average" id="avg-fcf">平均值: --</div>
                    <canvas id="chart-fcf"></canvas>
                </div>

                <!-- 利息保障倍數 -->
                <div class="chart-card">
                    <h3 class="chart-title">利息保障倍數</h3>
                    <div class="chart-average" id="avg-tie">平均值: --</div>
                    <canvas id="chart-tie"></canvas>
                </div>

                <!-- 流動比率 -->
                <div class="chart-card">
                    <h3 class="chart-title">流動比率</h3>
                    <div class="chart-average" id="avg-cr">平均值: --</div>
                    <canvas id="chart-cr"></canvas>
                </div>
            </div>
        </section>

        <!-- Credit Score Section -->
        <section id="score-section" class="score-section hidden">
            <div class="score-card">
                <h2 class="section-title">授信評分 Credit Score</h2>

                <div class="score-layout">
                    <!-- 左側：大型分數卡片 -->
                    <div class="score-left">
                        <div class="score-main">
                            <div class="score-value" id="total-score">--</div>
                            <div class="score-label">總分 / 100</div>
                            <div class="score-grade" id="score-grade">--</div>
                        </div>
                    </div>

                    <!-- 右側：AI評語 + 細項評分 -->
                    <div class="score-right">
                        <!-- AI評語區塊 -->
                        <div class="ai-comment" id="ai-comment">
                            <div class="ai-icon">🤖</div>
                            <div class="ai-text" id="ai-comment-text">AI分析中，請稍候...</div>
                        </div>

                        <!-- 細項評分網格 (2行4列) -->
                        <div class="score-breakdown">
                            <div class="score-item">
                                <span class="score-item-label">償債年限</span>
                                <span class="score-item-value" id="score-debt-ebitda">-- / 20</span>
                            </div>
                            <div class="score-item">
                                <span class="score-item-label">EBITDA穩定性</span>
                                <span class="score-item-value" id="score-ebitda-std">-- / 20</span>
                            </div>
                            <div class="score-item">
                                <span class="score-item-label">現金流償債能力</span>
                                <span class="score-item-value" id="score-fcf-debt">-- / 20</span>
                            </div>
                            <div class="score-item">
                                <span class="score-item-label">利息保障倍數</span>
                                <span class="score-item-value" id="score-tie">-- / 10</span>
                            </div>
                            <div class="score-item">
                                <span class="score-item-label">資本支出效率</span>
                                <span class="score-item-value" id="score-capex">-- / 10</span>
                            </div>
                            <div class="score-item">
                                <span class="score-item-label">流動比率</span>
                                <span class="score-item-value" id="score-cr">-- / 5</span>
                            </div>
                            <div class="score-item">
                                <span class="score-item-label">營收成長穩定性</span>
                                <span class="score-item-value" id="score-sales-std">-- / 5</span>
                            </div>
                            <div class="score-item">
                                <span class="score-item-label">短期債務結構</span>
                                <span class="score-item-value" id="score-std-assets">-- / 10</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- 設定對話框 -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>API 安全設定</h2>
                <button id="close-settings" class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="settings-hint">這些金鑰將僅儲存在您的瀏覽器中，不會上傳。請確保在公開此專案前，<code>config.js</code> 中已無硬編碼金鑰。</p>
                <div class="form-group">
                    <div class="label-row">
                        <label for="gemini-key">Gemini API Key</label>
                        <button id="test-gemini" class="test-btn">測試連線</button>
                    </div>
                    <input type="password" id="gemini-key" placeholder="輸入 Google AI Studio 的 API 金鑰...">
                    <div id="gemini-test-result" class="test-result"></div>
                    <small>用於 AI 授信評分 (Google AI Studio)</small>
                </div>
                <div class="form-group">
                    <div class="label-row">
                        <label for="news-key">GNews API Key</label>
                        <button id="test-news" class="test-btn">測試連線</button>
                    </div>
                    <input type="password" id="news-key" placeholder="輸入 GNews API 金鑰...">
                    <div id="news-test-result" class="test-result"></div>
                    <small>用於 AML 反洗錢檢測 (GNews.io)</small>
                </div>
                <div class="modal-footer">
                    <button id="save-settings" class="save-btn">儲存設定</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config.js?v=4.0"></script>
    <script src="app.js?v=4.3"></script>
</body>

</html>